function suanqian(){for(var e=0,a=0,o=0;o<$(".activePrice").length;o++)e=parseFloat($(".activePrice span").eq(o).html())*parseInt($(".proCount").eq(o).val()),a+=Number(e);a=a.toFixed(2),$(".all p span").html(a)}function clearAll(){$("ul li").not($("ul li:last-child")).remove()}function localshengcheng(){clearAll(),showCar(),$(shuju).each(function(e){var a=$("ul li").eq(0).clone().show();a.find("img")[0].src=$(this)[0].imgSrc,a.find("p").eq(0).html($(this)[0].name),a.find("p").last().find("span").html($(this)[0].price),a.find(".pColor").html($(this)[0].color),a.find(".pSize").html($(this)[0].size),a.find("input").val($(this)[0].num),a.find(".price span").html($(this)[0].price),a.prependTo($("ul"))}),suanqian()}function showCar(){1==Boolean(localStorage.message)?($("#tip").hide(),$("#product").show()):($("#tip").show(),$("#product").hide())}var shuju=localStorage.message?JSON.parse(localStorage.message):[];suanqian(),showCar(),localshengcheng(),$(function(){setTimeout(function(){new iScroll("wrapper",{useTransform:!1,onBeforeScrollStart:function(e){for(var a=e.target;1!=a.nodeType;)a=a.parentNode;"SELECT"!=a.tagName&&"INPUT"!=a.tagName&&"TEXTAREA"!=a.tagName&&e.preventDefault()}})},200)});for(var i=0;i<$(".activePrice").length;i++)$("#product li")[i].onoff=!0;$("#product").delegate("li","tap",function(){$(this)[0].onoff?($(this).css("border-color","#fff"),$(this).find(".sec").hide(),$(this).find(".price").removeClass("activePrice").addClass("noPrice"),$(this)[0].onoff=!1,suanqian()):($(this).css("border-color",""),$(this).find(".sec").show(),$(this).find(".noPrice").addClass("activePrice").removeClass("noPrice"),$(this)[0].onoff=!0,suanqian())});var numDel=-1;touch.on(".all .del","tap",function(){var e=($(".activePrice").parent().parent(),$(".noPrice").parent().parent(),[]);e.push(JSON.parse(localStorage.message)),shuju=e[0];for(var a=$("#product li").length-1,o=0;o<a;o++)if($("#product li").eq(o)[0].onoff){numDel++;var n=o-1-numDel;shuju.splice(n,1)}0==shuju&&(shuju=null),1==Boolean(shuju)?localStorage.message=JSON.stringify(shuju):localStorage.message="",localshengcheng(),suanqian()}),touch.on(".delAll","tap",function(){localStorage.message="",$("#product li").not($("#product li:last-of-type")).remove(),shuju=null,showCar()}),touch.on(".proCount","tap",function(e){e.cancelBubble=!0;var a=$(this).parent().parent().index(),o=$(this);$(".mask").css({width:$("ul").width(),height:$("ul").height()}).show(),touch.on(document,"tap",function(){suanqian(),$(".mask").hide(),$(".proCount").blur();var e=parseInt(o.val()),n=JSON.parse(localStorage.message),t=n.length-a-1;n[t].num=e,localStorage.message=JSON.stringify(n)})});